System.register(["./Container.vue_vue_type_script_setup_true_lang-legacy-5wTbi-oy.js","./index-legacy-BmHbVtLw.js","./index-legacy-DDDqUOFl.js","./index-legacy-BHxkhfyJ.js","./index-legacy-_0j-K95u.js","./index-legacy-Dcu0vVO7.js","./index-legacy-1OqzN4Us.js","./index-legacy-DLm-X8x8.js","./index-legacy-C4IZEz2w.js","./index-legacy-4oKbo2up.js","./index-legacy-By73AkkA.js","./index-legacy-FXK0umME.js","./index-legacy-DjXLRpCA.js","./index-legacy-DXZvcBPk.js","./_plugin-vue_export-helper-legacy-DgAO6S8O.js","./index-legacy-B6r4yNyH.js","./mount-component-legacy-Dg-kNqcX.js","./use-id-legacy-Dd4fgc7n.js"],(function(e,l){"use strict";var a,t,n,u,i,s,o,d,c,v,r,m,p,y,f,h,g,w,b,_,k,x,I,C,j,D,$,q,U,V,A,S,Q,F,T,z,E,N,P;return{setters:[e=>{a=e._},e=>{t=e.d,n=e.r,u=e.c,i=e.aA,s=e.q,o=e.ag,d=e.e,c=e.f,v=e.aB,r=e.o,m=e.g,p=e.v,y=e.C,f=e.p,h=e.k,g=e.m,w=e.F,b=e.aC,_=e.A,k=e.B},e=>{x=e.T},null,e=>{I=e.C},e=>{C=e.C},null,e=>{j=e.F},e=>{D=e.f,$=e.S,q=e.a},e=>{U=e.a,V=e.b,A=e.u,S=e.s,Q=e.c,F=e.G},e=>{T=e.B},e=>{z=e.F},e=>{E=e.P},e=>{N=e.P},e=>{P=e._},null,null,null],execute:function(){const l=e=>(_("data-v-cc7f2551"),e=e(),k(),e),M={class:"iframe-grid mt-10"},B=["src"],G={key:1,class:"mt-20 text-right"},L={key:0},O=l((()=>f("h3",{class:"text-center"},"下发设置",-1))),H={class:"m-15"},Y=l((()=>f("h3",{class:"text-center"},"请根据文件内容答题",-1))),J={class:"m-15"};e("default",P(t({__name:"detail",setup(e){const l=n(0),t=n([]),_=n([]);n({src:"https://m.baidu.com/"});const k=v(),P=n({}),K=n(!1),R=n(!1),W=n(!1),X=n(!1),Z=n(""),ee=n(!1),le=n(null),ae=n({circulationDocId:"",userAnswers:[]}),te=n(1),ne=n(!1),ue=n({circulationDocId:"",studyDuration:0}),ie=n(0),se=n([]),oe=n([]),de=n([]),ce=n(0),ve=n([]),re=n(0),me=n(0),pe=n(null);function ye(e){Ce(2),A(ae.value).then((e=>{200===e.statusCode?(S({type:"success",message:"提交成功"}),Ce(2),b.go(-1)):(S({type:"danger",message:e.msg}),te.value=1)}))}u((()=>Math.round(me.value)));const fe=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;function he(e){const[l,a]=e;K.value=!1,P.value.dateTime=`${fe(l)} ~ ${fe(a)}`}async function ge(e){l.value=e;const a=_.value[e];if(!a.children){const e=await async function(e){return F({DepartmentId:e,Skip:1,PageSize:50}).then((e=>e.map((e=>({text:e.firstName,id:Number(e.userName)})))))}(a.id);a.children=e}}function we(e){const l=[...t.value],a=l.indexOf(e.id);-1===a?l.push(e.id):l.splice(a,1),t.value=l,P.value.persons=l}function be(){null===pe.value&&(re.value=Date.now(),pe.value=window.setInterval(ke,1e3))}function _e(){null!==pe.value&&(clearInterval(pe.value),pe.value=null,ke())}function ke(){const e=Date.now();me.value+=Math.floor((e-re.value)/1e3),re.value=e,console.log(me.value,"readingTime")}function xe(){"hidden"===document.visibilityState?_e():"visible"===document.visibilityState&&be()}function Ie({selectedOptions:e}){ve.value[ce.value]=e.map((e=>e.description)).join("/"),ae.value.userAnswers[ce.value].answerId=e[0]?.id,ee.value=!1}function Ce(e){ue.value.studyDuration=Math.round(me.value),Q(ue.value).then((l=>{200===l.statusCode?(te.value=e,b.back(-1)):(S({type:"danger",message:l.msg}),te.value=0)}))}function je(){_e(),me.value>ie.value?(Ce(2),X.value=!0):(S({type:"warning",message:`学习时间不足${ie.value}秒`}),be())}i((()=>{le.value=k.query.isFinished})),s((()=>{be(),function(){const e=k.query.documentId,l=k.query.name;V(e).then((a=>{const t=a.result,n=`http://172.20.153.9:5001/api/document/${e}/officeviewer?token=${t}&isVersion=false&fullfilename=${l}`,u=(new TextEncoder).encode(n),i=D(u);Z.value=`http://172.20.153.9:8012/onlinePreview?url=${i}`}))}(),U({id:k.query.id}).then((e=>{ae.value.circulationDocId=e.data.id,ue.value.circulationDocId=e.data.id,ne.value=e.data.isHasQuestion,ie.value=Number(e.data.browseDuration),e.data.circulationQuestions.forEach((e=>{oe.value.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,options:e.circulationQuestionAnswers}),ae.value.userAnswers.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,answerId:""}),se.value.push(e.title)}))})),document.addEventListener("visibilitychange",xe)})),o((()=>{_e(),document.removeEventListener("visibilitychange",xe)}));const De={text:"description",value:"id"};return(e,n)=>{const u=$,i=q,s=T,o=j,v=C,b=z,k=E,D=N,U=I,V=x,A=a;return r(),d(A,null,{default:c((()=>["false"==le.value?(r(),d(i,{key:0,active:e.active,class:"mt10"},{default:c((()=>[m(u,null,{default:c((()=>[p("查看")])),_:1}),ne.value?(r(),d(u,{key:0},{default:c((()=>[p("答题")])),_:1})):y("",!0),m(u,null,{default:c((()=>[p("确认")])),_:1})])),_:1},8,["active"])):y("",!0),f("div",M,[f("iframe",{ref:"iframe",src:Z.value,width:"100%",height:"500px",frameborder:"0",allowfullscreen:""},null,8,B)]),"false"==le.value?(r(),h("div",G,[ne.value?(r(),h("div",L,[1===te.value?(r(),d(s,{key:0,type:"primary",size:"small",block:"",onClick:je},{default:c((()=>[p("答题")])),_:1})):y("",!0),2===te.value?(r(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:n[0]||(n[0]=e=>Ce(2))},{default:c((()=>[p("确认")])),_:1})):y("",!0)])):(r(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:n[1]||(n[1]=e=>(_e(),void(me.value>ie.value?Ce(2):(S({type:"warning",message:`学习时间不足${ie.value}秒`}),be()))))},{default:c((()=>[p("确认2")])),_:1}))])):y("",!0),m(k,{show:W.value,"onUpdate:show":n[6]||(n[6]=e=>W.value=e),position:"bottom",title:"下发设置",style:{width:"100%",height:"80%"}},{default:c((()=>[O,m(b,{onSubmit:ye},{default:c((()=>[m(v,{inset:""},{default:c((()=>[m(o,{modelValue:P.value.dateTime,"onUpdate:modelValue":n[2]||(n[2]=e=>P.value.dateTime=e),"is-link":"",readonly:"",name:"datePicker",label:"时间选择",placeholder:"点击选择时间",onClick:n[3]||(n[3]=e=>K.value=!0)},null,8,["modelValue"]),m(o,{modelValue:t.value,"onUpdate:modelValue":n[4]||(n[4]=e=>t.value=e),"is-link":"",readonly:"",name:"persons",label:"人员选择",placeholder:"点击下发人员",onClick:n[5]||(n[5]=e=>R.value=!0)},null,8,["modelValue"])])),_:1}),f("div",H,[m(s,{round:"",block:"",type:"primary","native-type":"submit"},{default:c((()=>[p("提交")])),_:1})])])),_:1})])),_:1},8,["show"]),m(k,{show:X.value,"onUpdate:show":n[7]||(n[7]=e=>X.value=e),position:"bottom",title:"答题",style:{width:"100%",height:"80%"}},{default:c((()=>[Y,m(b,{onSubmit:ye},{default:c((()=>[m(v,{inset:""},{default:c((()=>[(r(!0),h(w,null,g(ae.value.userAnswers,((e,l)=>(r(),d(o,{placeholder:"请选择答案",key:e.questionId,modelValue:ve.value[l],"onUpdate:modelValue":e=>ve.value[l]=e,disabled:"",label:`${se.value[l]}:`,"label-width":"160px","label-align":"right",onClick:a=>function(e,l){de.value=oe.value.find((l=>l.questionId===e)).options,ce.value=l,ee.value=!0}(e.questionId,l)},null,8,["modelValue","onUpdate:modelValue","label","onClick"])))),128))])),_:1}),f("div",J,[m(s,{round:"",block:"",type:"primary","native-type":"submit"},{default:c((()=>[p("提交")])),_:1})])])),_:1})])),_:1},8,["show"]),m(k,{show:ee.value,"onUpdate:show":n[9]||(n[9]=e=>ee.value=e),position:"bottom"},{default:c((()=>[m(D,{columns:de.value,"columns-field-names":De,onConfirm:Ie,onCancel:n[8]||(n[8]=()=>ee.value=!1)},null,8,["columns"])])),_:1},8,["show"]),m(U,{show:K.value,"onUpdate:show":n[10]||(n[10]=e=>K.value=e),type:"range",onConfirm:he},null,8,["show"]),m(k,{show:R.value,"onUpdate:show":n[13]||(n[13]=e=>R.value=e),position:"bottom"},{default:c((()=>[m(V,{"active-id":t.value,"onUpdate:activeId":n[11]||(n[11]=e=>t.value=e),"main-active-index":l.value,"onUpdate:mainActiveIndex":n[12]||(n[12]=e=>l.value=e),items:_.value,onClickNav:ge,onClickItem:we},null,8,["active-id","main-active-index","items"])])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-cc7f2551"]]))}}}));
