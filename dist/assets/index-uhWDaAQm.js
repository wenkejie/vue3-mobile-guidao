import{K as $,V as de,ai as w,aS as z,d as J,T as Y,aK as N,ax as V,r as S,c as p,ah as oe,aT as fe,an as ae,g as m,X as le,Q,R as _,S as ve,a0 as he,a3 as ge,aU as be,w as L,aV as j,J as W,aq as X,P as Te,aW as Oe}from"./index-Ti0Ywde6.js";import{a as pe,u as ce}from"./index-DG-rwu-t.js";import{L as ke}from"./index-C4CADt03.js";const[xe,T,Z]=$("picker"),ie=e=>e.find(a=>!a.disabled)||e[0];function ye(e,a){const o=e[0];if(o){if(Array.isArray(o))return"multiple";if(a.children in o)return"cascade"}return"default"}function B(e,a){a=z(a,0,e.length);for(let o=a;o<e.length;o++)if(!e[o].disabled)return o;for(let o=a-1;o>=0;o--)if(!e[o].disabled)return o;return 0}const ee=(e,a,o)=>a!==void 0&&!!e.find(s=>s[o.value]===a);function G(e,a,o){const s=e.findIndex(f=>f[o.value]===a),c=B(e,s);return e[c]}function Ce(e,a,o){const s=[];let c={[a.children]:e},f=0;for(;c&&c[a.children];){const v=c[a.children],h=o.value[f];if(c=de(h)?G(v,h,a):void 0,!c&&v.length){const u=ie(v)[a.value];c=G(v,u,a)}f++,s.push(v)}return s}function Ee(e){const{transform:a}=window.getComputedStyle(e),o=a.slice(7,a.length-1).split(", ")[5];return Number(o)}function Se(e){return w({text:"text",value:"value",children:"children"},e)}const te=200,ne=300,we=15,[se,q]=$("picker-column"),ue=Symbol(se);var Pe=J({name:se,props:{value:Y,fields:N(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(Y),visibleOptionNum:N(Y)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:o}){let s,c,f,v,h;const u=S(),g=S(),r=S(0),d=S(0),x=pe(),y=()=>e.options.length,M=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=i=>{let t=B(e.options,i);const n=-t*e.optionHeight,l=()=>{t>y()-1&&(t=B(e.options,i));const O=e.options[t][e.fields.value];O!==e.value&&a("change",O)};s&&n!==r.value?h=l:l(),r.value=n},b=()=>e.readonly||!e.options.length,A=i=>{s||b()||(h=null,d.value=te,k(i),a("clickOption",e.options[i]))},C=i=>z(Math.round(-i/e.optionHeight),0,y()-1),D=p(()=>C(r.value)),K=(i,t)=>{const n=Math.abs(i/t);i=r.value+n/.003*(i<0?-1:1);const l=C(i);d.value=+e.swipeDuration,k(l)},P=()=>{s=!1,d.value=0,h&&(h(),h=null)},U=i=>{if(!b()){if(x.start(i),s){const t=Ee(g.value);r.value=Math.min(0,t-M())}d.value=0,c=r.value,f=Date.now(),v=c,h=null}},F=i=>{if(b())return;x.move(i),x.isVertical()&&(s=!0,le(i,!0));const t=z(c+x.deltaY.value,-(y()*e.optionHeight),e.optionHeight),n=C(t);n!==D.value&&a("scrollInto",e.options[n]),r.value=t;const l=Date.now();l-f>ne&&(f=l,v=t)},I=()=>{if(b())return;const i=r.value-v,t=Date.now()-f;if(t<ne&&Math.abs(i)>we){K(i,t);return}const l=C(r.value);d.value=te,k(l),setTimeout(()=>{s=!1},0)},E=()=>{const i={height:"".concat(e.optionHeight,"px")};return e.options.map((t,n)=>{const l=t[e.fields.text],{disabled:O}=t,H=t[e.fields.value],re={role:"button",style:i,tabindex:O?-1:0,class:[q("item",{disabled:O,selected:H===e.value}),t.className],onClick:()=>A(n)},me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return m("li",re,[o.option?o.option(t,n):m("div",me,null)])})};return oe(ue),ce({stopMomentum:P}),fe(()=>{const i=s?Math.floor(-r.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=B(e.options,i),n=-t*e.optionHeight;s&&t<i&&P(),r.value=n}),ae("touchmove",F,{target:u}),()=>m("div",{ref:u,class:q(),onTouchstartPassive:U,onTouchend:I,onTouchcancel:I},[m("ul",{ref:g,style:{transform:"translate3d(0, ".concat(r.value+M(),"px, 0)"),transitionDuration:"".concat(d.value,"ms"),transitionProperty:d.value?"all":"none"},class:q("wrapper"),onTransitionend:P},[E()])])}});const[Ie]=$("picker-toolbar"),R={title:String,cancelButtonText:String,confirmButtonText:String},He=["cancel","confirm","title","toolbar"],Me=Object.keys(R);var De=J({name:Ie,props:R,emits:["confirm","cancel"],setup(e,{emit:a,slots:o}){const s=()=>{if(o.title)return o.title();if(e.title)return m("div",{class:[T("title"),"van-ellipsis"]},[e.title])},c=()=>a("cancel"),f=()=>a("confirm"),v=()=>{var u;const g=(u=e.cancelButtonText)!=null?u:Z("cancel");if(!(!o.cancel&&!g))return m("button",{type:"button",class:[T("cancel"),Q],onClick:c},[o.cancel?o.cancel():g])},h=()=>{var u;const g=(u=e.confirmButtonText)!=null?u:Z("confirm");if(!(!o.confirm&&!g))return m("button",{type:"button",class:[T("confirm"),Q],onClick:f},[o.confirm?o.confirm():g])};return()=>m("div",{class:T("toolbar")},[o.toolbar?o.toolbar():[v(),s(),h()]])}});const[Ne,Ke]=$("picker-group"),_e=Symbol(Ne);w({tabs:V(),activeTab:_(0),nextStepText:String},R);const Be=w({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:_(44),showToolbar:ve,swipeDuration:_(1e3),visibleOptionNum:_(6)},R),Ve=w({},Be,{columns:V(),modelValue:V(),toolbarPosition:he("top"),columnsFieldNames:Object});var Ue=J({name:xe,props:Ve,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:o}){const s=S(),c=S(e.modelValue.slice(0)),{parent:f}=oe(_e),{children:v,linkChildren:h}=ge(ue);h();const u=p(()=>Se(e.columnsFieldNames)),g=p(()=>be(e.optionHeight)),r=p(()=>ye(e.columns,u.value)),d=p(()=>{const{columns:t}=e;switch(r.value){case"multiple":return t;case"cascade":return Ce(t,u.value,c);default:return[t]}}),x=p(()=>d.value.some(t=>t.length)),y=p(()=>d.value.map((t,n)=>G(t,c.value[n],u.value))),M=p(()=>d.value.map((t,n)=>t.findIndex(l=>l[u.value.value]===c.value[n]))),k=(t,n)=>{if(c.value[t]!==n){const l=c.value.slice(0);l[t]=n,c.value=l}},b=()=>({selectedValues:c.value.slice(0),selectedOptions:y.value,selectedIndexes:M.value}),A=(t,n)=>{k(n,t),r.value==="cascade"&&c.value.forEach((l,O)=>{const H=d.value[O];ee(H,l,u.value)||k(O,H.length?H[0][u.value.value]:void 0)}),W(()=>{a("change",w({columnIndex:n},b()))})},C=(t,n)=>{const l={columnIndex:n,currentOption:t};a("clickOption",w(b(),l)),a("scrollInto",l)},D=()=>{v.forEach(n=>n.stopMomentum());const t=b();return W(()=>{a("confirm",t)}),t},K=()=>a("cancel",b()),P=()=>d.value.map((t,n)=>m(Pe,{value:c.value[n],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:g.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>A(l,n),onClickOption:l=>C(l,n),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:n})}},{option:o.option})),U=t=>{if(x.value){const n={height:"".concat(g.value,"px")},l={backgroundSize:"100% ".concat((t-g.value)/2,"px")};return[m("div",{class:T("mask"),style:l},null),m("div",{class:[Oe,T("frame")],style:n},null)]}},F=()=>{const t=g.value*+e.visibleOptionNum,n={height:"".concat(t,"px")};return m("div",{ref:s,class:T("columns"),style:n},[P(),U(t)])},I=()=>{if(e.showToolbar&&!f)return m(De,Te(X(e,Me),{onConfirm:D,onCancel:K}),X(o,He))};L(d,t=>{t.forEach((n,l)=>{n.length&&!ee(n,c.value[l],u.value)&&k(l,ie(n)[u.value.value])})},{immediate:!0});let E;return L(()=>e.modelValue,t=>{!j(t,c.value)&&!j(t,E)&&(c.value=t.slice(0),E=t.slice(0))},{deep:!0}),L(c,t=>{j(t,e.modelValue)||(E=t.slice(0),a("update:modelValue",E))},{immediate:!0}),ae("touchmove",le,{target:s}),ce({confirm:D,getSelectedOptions:()=>y.value}),()=>{var t,n;return m("div",{class:T()},[e.toolbarPosition==="top"?I():null,e.loading?m(ke,{class:T("loading")},null):null,(t=o["columns-top"])==null?void 0:t.call(o),F(),(n=o["columns-bottom"])==null?void 0:n.call(o),e.toolbarPosition==="bottom"?I():null])}}});export{Be as p,Ue as s};
