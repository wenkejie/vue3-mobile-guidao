import{_ as me}from"./Container.vue_vue_type_script_setup_true_lang-GLuEUgiL.js";import{d as fe,r as o,a as pe,e as k,f as i,K as ve,o as w,g as l,v as p,h as a,C as _e,p as v,j as d,k as he,m as we,F as ye}from"./index-CIq-oMdo.js";import{f as ge,T as ke}from"./index-CKZ_uliA.js";import"./index-C0-qw_Ps.js";import{C as Ie}from"./index-BheCoyUB.js";import{C as be}from"./index-H4v7lFx6.js";import"./index-gofcAkLv.js";import{F as De}from"./index-CfBzFnno.js";import{S as Ce,a as Te}from"./index-C1wYFSlc.js";import{a as Ae,c as Ve,s as $e,d as Ue,G as xe}from"./index-Da8Krel5.js";import{B as Fe}from"./index-CCszsqzv.js";import{F as qe}from"./index-BLH94utM.js";import{P as Ne}from"./index-DEoV0_af.js";import{P as Pe}from"./index-DY168d6S.js";import"./use-scope-id-sANgzUDS.js";import"./index-s7_3JXei.js";import"./use-id-BlRh9Qoc.js";const Qe=["src"],Se={class:"mt-20 text-right"},Be=v("h3",{class:"text-center"},"下发设置",-1),Ee={class:"m-15"},Me=v("h3",{class:"text-center"},"请根据文件内容答题",-1),ze={class:"m-15"},lt=fe({__name:"detail2",setup(Ge){const I=o(0),r=o([]),E=o([]);o([]),pe(),o({src:"https://m.baidu.com/"});const x=ve(),F=o({}),y=o(!1),b=o(!1);o(!0),o(""),o(""),o([]),o(0);const D=o(0),q=o(!1),C=o(!1);function H(){C.value=!0}const M=o("");function z(t){console.log("submit",m.value)}const G=t=>"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate());function K(t){const[e,n]=t;y.value=!1,F.value.dateTime="".concat(G(e)," ~ ").concat(G(n))}async function Y(t){return new Promise(e=>{setTimeout(()=>{xe({DepartmentId:t,Skip:1,PageSize:50}).then(n=>{const f=[];n.forEach(c=>{f.push({text:c.firstName,id:Number(c.userName)})}),console.log(f,"userArr"),e(f)})},1e3)})}async function J(t){I.value=t;const e=E.value[t];if(!e.children){const n=await Y(e.id);e.children=n}}function W(t){const e=[...r.value],n=e.indexOf(Number(t.id));return n==-1?(e.push(t.id),!1):(e.splice(n,1),console.log(r.value,"activeIds.value"),!1)}function X(){const t=x.query.documentId,e=x.query.name;Ae(t).then(n=>{const f=n.result,V="".concat("http://172.16.70.50:5001/","api/document/").concat(t,"/officeviewer?token=").concat(f,"&isVersion=false&fullfilename=").concat(e),$=new TextEncoder().encode(V),h=ge($);M.value="http://172.20.153.9:8012/onlinePreview?url=".concat(h)})}const m=o({circulationDocId:"",userAnswers:[]}),T=o(1),N=o(!1),u=o({circulationDocId:"",studyDuration:0}),P=o([]),Q=o([]),L=o([]),S=o(0),B=o([]),_=o(!1);function Z(t,e){S.value=e,_.value=!0,L.value=ee(t)}function ee(t){const e=Q.value.find(n=>n.questionId===t);return e?e.options:[]}const g=o(0);function te(){g.value||(g.value=Date.now(),console.log(u.value.studyDuration,"startTime"))}function oe(){if(g.value){const e=(Date.now()-g.value)/1e3;u.value.studyDuration+=e,g.value=0,console.log(u.value.studyDuration,"endTime")}}function ne({selectedOptions:t}){var e,n;B.value[S.value]=(e=t[0])==null?void 0:e.description,m.value.userAnswers[S.value].answerId=(n=t[0])==null?void 0:n.id,_.value=!1}const se={text:"description",value:"id"};function R(){m.value={circulationDocId:"",userAnswers:[]},u.value={circulationDocId:"",studyDuration:0},D.value=0,P.value=[],Q.value=[],proxy.resetForm("formRef"),handelQuery()}function ae(){const t=x.query.id;Ve({id:t}).then(e=>{m.value.circulationDocId=e.data.id,u.value.circulationDocId=e.data.id,N.value=e.data.isHasQuestion,e.data.circulationQuestions.forEach(n=>{Q.value.push({questionId:n.circulationQuestionAnswers[0].circulationQuestionId,options:n.circulationQuestionAnswers}),m.value.userAnswers.push({questionId:n.circulationQuestionAnswers[0].circulationQuestionId,answerId:""}),P.value.push(n.title)}),D.value=e.data.browseDuration})}ae();function le(){u.value.studyDuration>D.value?(O(2),H()):$e({type:"danger",message:"学习时间不足".concat(D.value,"秒")})}function O(t){u.value.studyDuration=Math.round(u.value.studyDuration)*1e3,Ue(u.value).then(e=>{e.statusCode==200?T.value=t:console.log(e.msg)})}function ie(){T.value==1?(O(1),R(),openFileView.value=!1):updateCirculationDocAnswer(m.value).then(t=>{t.statusCode==200?(ElMessage({message:"提交成功",type:"success"}),R(),openFileView.value=!1):(ElMessage({message:t.msg,type:"error"}),T.value=1)})}return X(),(t,e)=>{const n=Ce,f=Te,c=Fe,A=De,V=be,$=qe,h=Ne,ue=Pe,re=Ie,ce=ke,de=me;return w(),k(de,null,{default:i(()=>[l(f,{active:t.active,class:"mt10"},{default:i(()=>[l(n,null,{default:i(()=>[p("查看")]),_:1}),a(N)==!0?(w(),k(n,{key:0},{default:i(()=>[p("答题")]),_:1})):_e("",!0),l(n,null,{default:i(()=>[p("确认")]),_:1})]),_:1},8,["active"]),v("div",{class:"iframe-grid mt-10",onTouchstart:te,onTouchend:oe},[v("iframe",{ref:"iframe",src:a(M),width:"100%",height:"500px",frameborder:"0",allowfullscreen:""},null,8,Qe)],32),v("div",Se,[a(N)==!0&&a(T)==1?(w(),k(c,{key:0,type:"primary",size:"small",block:"",onClick:le},{default:i(()=>[p("答题")]),_:1})):(w(),k(c,{key:1,type:"primary",size:"small",block:"",onClick:ie},{default:i(()=>[p("确认")]),_:1}))]),l(h,{show:a(q),"onUpdate:show":e[4]||(e[4]=s=>d(q)?q.value=s:null),position:"bottom",title:"下发设置",style:{width:"100%",height:"80%"}},{default:i(()=>[Be,l($,{onSubmit:z},{default:i(()=>[l(V,{inset:""},{default:i(()=>[l(A,{modelValue:a(F).dateTime,"onUpdate:modelValue":e[0]||(e[0]=s=>a(F).dateTime=s),"is-link":"",readonly:"",name:"datePicker",label:"时间选择",placeholder:"点击选择时间",onClick:e[1]||(e[1]=s=>y.value=!0)},null,8,["modelValue"]),l(A,{modelValue:a(r),"onUpdate:modelValue":e[2]||(e[2]=s=>d(r)?r.value=s:null),"is-link":"",readonly:"",name:"persons",label:"人员选择",placeholder:"点击下发人员",onClick:e[3]||(e[3]=s=>{b.value=!0})},null,8,["modelValue"])]),_:1}),v("div",Ee,[l(c,{round:"",block:"",type:"primary","native-type":"submit"},{default:i(()=>[p(" 提交 ")]),_:1})])]),_:1})]),_:1},8,["show"]),l(h,{show:a(C),"onUpdate:show":e[5]||(e[5]=s=>d(C)?C.value=s:null),position:"bottom",title:"答题",style:{width:"100%",height:"80%"}},{default:i(()=>[Me,l($,{onSubmit:z},{default:i(()=>[l(V,{inset:""},{default:i(()=>[(w(!0),he(ye,null,we(a(m).userAnswers,(s,U)=>(w(),k(A,{key:s.questionId,modelValue:a(B)[U],"onUpdate:modelValue":j=>a(B)[U]=j,disabled:"true",label:"".concat(a(P)[U],":"),"label-width":"120px","label-align":"right",onClick:j=>Z(s.questionId,U)},null,8,["modelValue","onUpdate:modelValue","label","onClick"]))),128))]),_:1}),v("div",ze,[l(c,{round:"",block:"",type:"primary","native-type":"submit"},{default:i(()=>[p(" 提交 ")]),_:1})])]),_:1})]),_:1},8,["show"]),l(h,{show:a(_),"onUpdate:show":e[7]||(e[7]=s=>d(_)?_.value=s:null),position:"bottom"},{default:i(()=>[l(ue,{columns:a(L),"columns-field-names":se,onConfirm:ne,onCancel:e[6]||(e[6]=s=>_.value=!1)},null,8,["columns"])]),_:1},8,["show"]),l(re,{show:a(y),"onUpdate:show":e[8]||(e[8]=s=>d(y)?y.value=s:null),type:"range",onConfirm:K},null,8,["show"]),l(h,{show:a(b),"onUpdate:show":e[11]||(e[11]=s=>d(b)?b.value=s:null),position:"bottom"},{default:i(()=>[l(ce,{"active-id":a(r),"onUpdate:activeId":e[9]||(e[9]=s=>d(r)?r.value=s:null),"main-active-index":a(I),"onUpdate:mainActiveIndex":e[10]||(e[10]=s=>d(I)?I.value=s:null),items:a(E),onClickNav:J,onClickItem:W},null,8,["active-id","main-active-index","items"])]),_:1},8,["show"])]),_:1})}}});export{lt as default};
