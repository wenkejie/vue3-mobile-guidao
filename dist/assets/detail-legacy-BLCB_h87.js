System.register(["./Container.vue_vue_type_script_setup_true_lang-legacy-CP01r5C2.js","./index-legacy-9OZgdCRp.js","./index-legacy-DEYxqE2n.js","./index-legacy-BPvvYG6b.js","./index-legacy-Dbc7p3sP.js","./index-legacy-BgMNFsiw.js","./index-legacy-ad9KPgzi.js","./index-legacy-DxspYRJU.js","./index-legacy-BuM3H_7c.js","./index-legacy-Df6O_RHV.js","./index-legacy-D2macRrG.js","./index-legacy-BxvE3bsm.js","./index-legacy-5fz56Dyj.js","./index-legacy-DrKUOxFh.js","./_plugin-vue_export-helper-legacy-DgAO6S8O.js","./use-scope-id-legacy-CIAYnXz1.js","./index-legacy-BAGLBGCn.js","./use-id-legacy-Bsk_U-rn.js"],(function(e,l){"use strict";var a,t,n,u,i,s,o,d,c,v,r,m,p,y,f,h,g,w,b,_,k,x,I,j,C,D,$,U,V,q,A,S,Q,F,T,z,N,P,E;return{setters:[e=>{a=e._},e=>{t=e.d,n=e.r,u=e.c,i=e.aB,s=e.q,o=e.ai,d=e.e,c=e.f,v=e.K,r=e.o,m=e.g,p=e.v,y=e.C,f=e.p,h=e.k,g=e.m,w=e.F,b=e.aC,_=e.a1,k=e.a2},e=>{x=e.f,I=e.T},null,e=>{j=e.C},e=>{C=e.C},null,e=>{D=e.F},e=>{$=e.S,U=e.a},e=>{V=e.c,q=e.a,A=e.u,S=e.s,Q=e.d,F=e.G},e=>{T=e.B},e=>{z=e.F},e=>{N=e.P},e=>{P=e.P},e=>{E=e._},null,null,null],execute:function(){const l=e=>(_("data-v-81dd65b5"),e=e(),k(),e),M={class:"iframe-grid mt-10"},B=["src"],G={key:1,class:"mt-20 text-right"},H={key:0},L=l((()=>f("h3",{class:"text-center"},"下发设置",-1))),O={class:"m-15"},K=l((()=>f("h3",{class:"text-center"},"请根据文件内容答题",-1))),Y={class:"m-15"};e("default",E(t({__name:"detail",setup(e){const l=n(0),t=n([]),_=n([]);n({src:"https://m.baidu.com/"});const k=v(),E=n({}),J=n(!1),R=n(!1),W=n(!1),X=n(!1),Z=n(""),ee=n(!1),le=n(null),ae=n({circulationDocId:"",userAnswers:[]}),te=n(1),ne=n(!1),ue=n({circulationDocId:"",studyDuration:0}),ie=n(0),se=n([]),oe=n([]),de=n([]),ce=n(0),ve=n([]),re=n(0),me=n(0),pe=n(null);function ye(e){je(2),A(ae.value).then((e=>{200===e.statusCode?(S({type:"success",message:"提交成功"}),je(2),b.go(-1)):(S({type:"danger",message:e.msg}),te.value=1)}))}u((()=>Math.round(me.value)));const fe=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;function he(e){const[l,a]=e;J.value=!1,E.value.dateTime=`${fe(l)} ~ ${fe(a)}`}async function ge(e){l.value=e;const a=_.value[e];if(!a.children){const e=await async function(e){return F({DepartmentId:e,Skip:1,PageSize:50}).then((e=>e.map((e=>({text:e.firstName,id:Number(e.userName)})))))}(a.id);a.children=e}}function we(e){const l=[...t.value],a=l.indexOf(e.id);-1===a?l.push(e.id):l.splice(a,1),t.value=l,E.value.persons=l}function be(){null===pe.value&&(re.value=Date.now(),pe.value=window.setInterval(ke,1e3))}function _e(){null!==pe.value&&(clearInterval(pe.value),pe.value=null,ke())}function ke(){const e=Date.now();me.value+=Math.floor((e-re.value)/1e3),re.value=e,console.log(me.value,"readingTime")}function xe(){"hidden"===document.visibilityState?_e():"visible"===document.visibilityState&&be()}function Ie({selectedOptions:e}){ve.value[ce.value]=e.map((e=>e.description)).join("/"),ae.value.userAnswers[ce.value].answerId=e[0]?.id,ee.value=!1}function je(e){ue.value.studyDuration=Math.round(me.value),Q(ue.value).then((l=>{200===l.statusCode?te.value=e:(S({type:"danger",message:l.msg}),te.value=0)}))}function Ce(){_e(),me.value>ie.value?(je(2),X.value=!0):(S({type:"warning",message:`学习时间不足${ie.value}秒`}),be())}i((()=>{le.value=k.query.isFinished})),s((()=>{be(),function(){const e=k.query.documentId,l=k.query.name;q(e).then((a=>{const t=a.result,n=`http://172.20.153.9:5001/api/document/${e}/officeviewer?token=${t}&isVersion=false&fullfilename=${l}`,u=(new TextEncoder).encode(n),i=x(u);Z.value=`http://172.20.153.9:8012/onlinePreview?url=${i}`}))}(),V({id:k.query.id}).then((e=>{ae.value.circulationDocId=e.data.id,ue.value.circulationDocId=e.data.id,ne.value=e.data.isHasQuestion,ie.value=Number(e.data.browseDuration),e.data.circulationQuestions.forEach((e=>{oe.value.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,options:e.circulationQuestionAnswers}),ae.value.userAnswers.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,answerId:""}),se.value.push(e.title)}))})),document.addEventListener("visibilitychange",xe)})),o((()=>{_e(),document.removeEventListener("visibilitychange",xe)}));const De={text:"description",value:"id"};return(e,n)=>{const u=$,i=U,s=T,o=D,v=C,k=z,x=N,V=P,q=j,A=I,Q=a;return r(),d(Q,null,{default:c((()=>["false"==le.value?(r(),d(i,{key:0,active:e.active,class:"mt10"},{default:c((()=>[m(u,null,{default:c((()=>[p("查看")])),_:1}),ne.value?(r(),d(u,{key:0},{default:c((()=>[p("答题")])),_:1})):y("",!0),m(u,null,{default:c((()=>[p("确认")])),_:1})])),_:1},8,["active"])):y("",!0),f("div",M,[f("iframe",{ref:"iframe",src:Z.value,width:"100%",height:"500px",frameborder:"0",allowfullscreen:""},null,8,B)]),"false"==le.value?(r(),h("div",G,[ne.value?(r(),h("div",H,[1===te.value?(r(),d(s,{key:0,type:"primary",size:"small",block:"",onClick:Ce},{default:c((()=>[p("答题")])),_:1})):y("",!0),2===te.value?(r(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:n[0]||(n[0]=e=>je(2))},{default:c((()=>[p("确认")])),_:1})):y("",!0)])):(r(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:n[1]||(n[1]=e=>(_e(),void(me.value>ie.value?(je(2),b.back(-1)):(S({type:"warning",message:`学习时间不足${ie.value}秒`}),be()))))},{default:c((()=>[p("确认")])),_:1}))])):y("",!0),m(x,{show:W.value,"onUpdate:show":n[6]||(n[6]=e=>W.value=e),position:"bottom",title:"下发设置",style:{width:"100%",height:"80%"}},{default:c((()=>[L,m(k,{onSubmit:ye},{default:c((()=>[m(v,{inset:""},{default:c((()=>[m(o,{modelValue:E.value.dateTime,"onUpdate:modelValue":n[2]||(n[2]=e=>E.value.dateTime=e),"is-link":"",readonly:"",name:"datePicker",label:"时间选择",placeholder:"点击选择时间",onClick:n[3]||(n[3]=e=>J.value=!0)},null,8,["modelValue"]),m(o,{modelValue:t.value,"onUpdate:modelValue":n[4]||(n[4]=e=>t.value=e),"is-link":"",readonly:"",name:"persons",label:"人员选择",placeholder:"点击下发人员",onClick:n[5]||(n[5]=e=>R.value=!0)},null,8,["modelValue"])])),_:1}),f("div",O,[m(s,{round:"",block:"",type:"primary","native-type":"submit"},{default:c((()=>[p("提交")])),_:1})])])),_:1})])),_:1},8,["show"]),m(x,{show:X.value,"onUpdate:show":n[7]||(n[7]=e=>X.value=e),position:"bottom",title:"答题",style:{width:"100%",height:"80%"}},{default:c((()=>[K,m(k,{onSubmit:ye},{default:c((()=>[m(v,{inset:""},{default:c((()=>[(r(!0),h(w,null,g(ae.value.userAnswers,((e,l)=>(r(),d(o,{placeholder:"请选择答案",key:e.questionId,modelValue:ve.value[l],"onUpdate:modelValue":e=>ve.value[l]=e,disabled:"",label:`${se.value[l]}:`,"label-width":"160px","label-align":"right",onClick:a=>function(e,l){de.value=oe.value.find((l=>l.questionId===e)).options,ce.value=l,ee.value=!0}(e.questionId,l)},null,8,["modelValue","onUpdate:modelValue","label","onClick"])))),128))])),_:1}),f("div",Y,[m(s,{round:"",block:"",type:"primary","native-type":"submit"},{default:c((()=>[p("提交")])),_:1})])])),_:1})])),_:1},8,["show"]),m(x,{show:ee.value,"onUpdate:show":n[9]||(n[9]=e=>ee.value=e),position:"bottom"},{default:c((()=>[m(V,{columns:de.value,"columns-field-names":De,onConfirm:Ie,onCancel:n[8]||(n[8]=()=>ee.value=!1)},null,8,["columns"])])),_:1},8,["show"]),m(q,{show:J.value,"onUpdate:show":n[10]||(n[10]=e=>J.value=e),type:"range",onConfirm:he},null,8,["show"]),m(x,{show:R.value,"onUpdate:show":n[13]||(n[13]=e=>R.value=e),position:"bottom"},{default:c((()=>[m(A,{"active-id":t.value,"onUpdate:activeId":n[11]||(n[11]=e=>t.value=e),"main-active-index":l.value,"onUpdate:mainActiveIndex":n[12]||(n[12]=e=>l.value=e),items:_.value,onClickNav:ge,onClickItem:we},null,8,["active-id","main-active-index","items"])])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-81dd65b5"]]))}}}));
