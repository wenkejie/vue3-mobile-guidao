import{_ as he}from"./Container.vue_vue_type_script_setup_true_lang-CasoIHbs.js";import{d as ye,r as o,c as we,aA as ge,q as ke,ag as be,e as r,f as s,aB as Ie,o as i,g as l,v as u,C as k,p,k as G,m as Ce,F as De,aC as te,A as $e,B as Te}from"./index-TK-srSu3.js";import{T as Ae}from"./index-ysAVPPc-.js";import"./index-DokfiJJG.js";import{C as Ue}from"./index-CcWJd2NX.js";import{C as Ve}from"./index-CRh_-Eff.js";import"./index-CsWnH0xd.js";import{F as xe}from"./index-CwVMRh3z.js";import{f as Se,S as qe,a as Ne}from"./index-g-rx2GeQ.js";import{a as Be,b as Fe,u as Qe,s as b,c as Pe,G as Me}from"./index-DTASQ6b-.js";import{B as Ee}from"./index-DzEt_uSR.js";import{F as Le}from"./index-ej9DYXD3.js";import{P as ze}from"./index-BWMpvfcB.js";import{P as Ge}from"./index-B6kKFSgX.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BOP6WUpe.js";import"./mount-component-B0NNVuVn.js";import"./use-id-Cw2yFWR7.js";const oe=I=>($e("data-v-cc7f2551"),I=I(),Te(),I),je={class:"iframe-grid mt-10"},He=["src"],Oe={key:1,class:"mt-20 text-right"},Ye={key:0},Je=oe(()=>p("h3",{class:"text-center"},"下发设置",-1)),Ke={class:"m-15"},We=oe(()=>p("h3",{class:"text-center"},"请根据文件内容答题",-1)),Xe={class:"m-15"},Ze=ye({__name:"detail",setup(I){const q=o(0),c=o([]),R=o([]);o({src:"https://m.baidu.com/"});const C=Ie(),D=o({}),$=o(!1),N=o(!1),j=o(!1),B=o(!1),H=o(""),f=o(!1),F=o(null),_=o({circulationDocId:"",userAnswers:[]}),h=o(1),Q=o(!1),P=o({circulationDocId:"",studyDuration:0}),y=o(0),O=o([]),Y=o([]),J=o([]),M=o(0),E=o([]),L=o(0),d=o(0),w=o(null);we(()=>Math.round(d.value));function K(t){g(2),Qe(_.value).then(e=>{e.statusCode===200?(b({type:"success",message:"提交成功"}),g(2),te.go(-1)):(b({type:"danger",message:e.msg}),h.value=1)})}const W=t=>"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate());function ne(t){const[e,a]=t;$.value=!1,D.value.dateTime="".concat(W(e)," ~ ").concat(W(a))}async function ae(t){return Me({DepartmentId:t,Skip:1,PageSize:50}).then(e=>e.map(a=>({text:a.firstName,id:Number(a.userName)})))}async function se(t){q.value=t;const e=R.value[t];if(!e.children){const a=await ae(e.id);e.children=a}}function le(t){const e=[...c.value],a=e.indexOf(t.id);a===-1?e.push(t.id):e.splice(a,1),c.value=e,D.value.persons=e}function ie(){const t=C.query.documentId,e=C.query.name;Fe(t).then(a=>{const z=a.result,V="".concat("http://172.20.153.9:5001/","api/document/").concat(t,"/officeviewer?token=").concat(z,"&isVersion=false&fullfilename=").concat(e),x=new TextEncoder().encode(V),v=Se(x);H.value="http://172.20.153.9:8012/onlinePreview?url=".concat(v)})}function T(){w.value===null&&(L.value=Date.now(),w.value=window.setInterval(X,1e3))}function A(){w.value!==null&&(clearInterval(w.value),w.value=null,X())}function X(){const t=Date.now();d.value+=Math.floor((t-L.value)/1e3),L.value=t,console.log(d.value,"readingTime")}function Z(){document.visibilityState==="hidden"?A():document.visibilityState==="visible"&&T()}function ue({selectedOptions:t}){var e;E.value[M.value]=t.map(a=>a.description).join("/"),_.value.userAnswers[M.value].answerId=(e=t[0])==null?void 0:e.id,f.value=!1}function re(t,e){J.value=Y.value.find(a=>a.questionId===t).options,M.value=e,f.value=!0}function g(t){P.value.studyDuration=Math.round(d.value),Pe(P.value).then(e=>{e.statusCode===200?(h.value=t,te.back(-1)):(b({type:"danger",message:e.msg}),h.value=0)})}function ce(){A(),d.value>y.value?g(2):(b({type:"warning",message:"学习时间不足".concat(y.value,"秒")}),T())}function de(){A(),d.value>y.value?(g(2),B.value=!0):(b({type:"warning",message:"学习时间不足".concat(y.value,"秒")}),T())}ge(()=>{F.value=C.query.isFinished}),ke(()=>{T(),ie(),Be({id:C.query.id}).then(t=>{_.value.circulationDocId=t.data.id,P.value.circulationDocId=t.data.id,Q.value=t.data.isHasQuestion,y.value=Number(t.data.browseDuration),t.data.circulationQuestions.forEach(e=>{Y.value.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,options:e.circulationQuestionAnswers}),_.value.userAnswers.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,answerId:""}),O.value.push(e.title)})}),document.addEventListener("visibilitychange",Z)}),be(()=>{A(),document.removeEventListener("visibilitychange",Z)});const me={text:"description",value:"id"};return(t,e)=>{const a=qe,z=Ne,m=Ee,U=xe,V=Ve,x=Le,v=ze,ve=Ge,pe=Ue,fe=Ae,_e=he;return i(),r(_e,null,{default:s(()=>[F.value=="false"?(i(),r(z,{key:0,active:t.active,class:"mt10"},{default:s(()=>[l(a,null,{default:s(()=>[u("查看")]),_:1}),Q.value?(i(),r(a,{key:0},{default:s(()=>[u("答题")]),_:1})):k("",!0),l(a,null,{default:s(()=>[u("确认")]),_:1})]),_:1},8,["active"])):k("",!0),p("div",je,[p("iframe",{ref:"iframe",src:H.value,width:"100%",height:"500px",frameborder:"0",allowfullscreen:""},null,8,He)]),F.value=="false"?(i(),G("div",Oe,[Q.value?(i(),G("div",Ye,[h.value===1?(i(),r(m,{key:0,type:"primary",size:"small",block:"",onClick:de},{default:s(()=>[u("答题")]),_:1})):k("",!0),h.value===2?(i(),r(m,{key:1,type:"primary",size:"small",block:"",onClick:e[0]||(e[0]=n=>g(2))},{default:s(()=>[u("确认")]),_:1})):k("",!0)])):(i(),r(m,{key:1,type:"primary",size:"small",block:"",onClick:e[1]||(e[1]=n=>ce(2))},{default:s(()=>[u("确认2")]),_:1}))])):k("",!0),l(v,{show:j.value,"onUpdate:show":e[6]||(e[6]=n=>j.value=n),position:"bottom",title:"下发设置",style:{width:"100%",height:"80%"}},{default:s(()=>[Je,l(x,{onSubmit:K},{default:s(()=>[l(V,{inset:""},{default:s(()=>[l(U,{modelValue:D.value.dateTime,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value.dateTime=n),"is-link":"",readonly:"",name:"datePicker",label:"时间选择",placeholder:"点击选择时间",onClick:e[3]||(e[3]=n=>$.value=!0)},null,8,["modelValue"]),l(U,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=n=>c.value=n),"is-link":"",readonly:"",name:"persons",label:"人员选择",placeholder:"点击下发人员",onClick:e[5]||(e[5]=n=>N.value=!0)},null,8,["modelValue"])]),_:1}),p("div",Ke,[l(m,{round:"",block:"",type:"primary","native-type":"submit"},{default:s(()=>[u("提交")]),_:1})])]),_:1})]),_:1},8,["show"]),l(v,{show:B.value,"onUpdate:show":e[7]||(e[7]=n=>B.value=n),position:"bottom",title:"答题",style:{width:"100%",height:"80%"}},{default:s(()=>[We,l(x,{onSubmit:K},{default:s(()=>[l(V,{inset:""},{default:s(()=>[(i(!0),G(De,null,Ce(_.value.userAnswers,(n,S)=>(i(),r(U,{placeholder:"请选择答案",key:n.questionId,modelValue:E.value[S],"onUpdate:modelValue":ee=>E.value[S]=ee,disabled:"",label:"".concat(O.value[S],":"),"label-width":"160px","label-align":"right",onClick:ee=>re(n.questionId,S)},null,8,["modelValue","onUpdate:modelValue","label","onClick"]))),128))]),_:1}),p("div",Xe,[l(m,{round:"",block:"",type:"primary","native-type":"submit"},{default:s(()=>[u("提交")]),_:1})])]),_:1})]),_:1},8,["show"]),l(v,{show:f.value,"onUpdate:show":e[9]||(e[9]=n=>f.value=n),position:"bottom"},{default:s(()=>[l(ve,{columns:J.value,"columns-field-names":me,onConfirm:ue,onCancel:e[8]||(e[8]=()=>f.value=!1)},null,8,["columns"])]),_:1},8,["show"]),l(pe,{show:$.value,"onUpdate:show":e[10]||(e[10]=n=>$.value=n),type:"range",onConfirm:ne},null,8,["show"]),l(v,{show:N.value,"onUpdate:show":e[13]||(e[13]=n=>N.value=n),position:"bottom"},{default:s(()=>[l(fe,{"active-id":c.value,"onUpdate:activeId":e[11]||(e[11]=n=>c.value=n),"main-active-index":q.value,"onUpdate:mainActiveIndex":e[12]||(e[12]=n=>q.value=n),items:R.value,onClickNav:se,onClickItem:le},null,8,["active-id","main-active-index","items"])]),_:1},8,["show"])]),_:1})}}}),yt=Re(Ze,[["__scopeId","data-v-cc7f2551"]]);export{yt as default};
