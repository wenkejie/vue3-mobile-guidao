import{r as W,aH as Ce,K,d as J,w as _,q as xe,s as Oe,g as c,P as ue,aq as q,a0 as E,T as L,aI as De,aj as he,I as Me,V as Re,ai as de,as as Pe,aJ as Be,ar as Ie,$ as be,ax as Ae,aK as p,c as R,aL as He,aM as Fe,L as Ne,ao as le,aN as $e,aO as We,S as F,R as ze,aP as ie,aQ as oe,aR as _e}from"./index-TK-srSu3.js";import{P as we,u as ke}from"./index-BWMpvfcB.js";import{B as Le}from"./index-DzEt_uSR.js";import{L as je}from"./index-BOP6WUpe.js";import{p as Ue}from"./index-DokfiJJG.js";import{m as Ve,u as Ye}from"./mount-component-B0NNVuVn.js";function qe(){const e=W([]),o=[];return Ce(()=>{e.value=[]}),[e,u=>(o[u]||(o[u]=d=>{e.value[u]=d}),o[u])]}let Y=0;function Ee(e){e?(Y||document.body.classList.add("van-toast--unclickable"),Y++):Y&&(Y--,Y||document.body.classList.remove("van-toast--unclickable"))}const[Ke,z]=K("toast"),Je=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Qe={icon:String,show:Boolean,type:E("text"),overlay:Boolean,message:L,iconSize:L,duration:De(2e3),position:E("middle"),teleport:[String,Object],wordBreak:String,className:he,iconPrefix:String,transition:E("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:he,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:L};var Se=J({name:Ke,props:Qe,emits:["update:show"],setup(e,{emit:o,slots:l}){let u,d=!1;const y=()=>{const h=e.show&&e.forbidClick;d!==h&&(d=h,Ee(d))},w=h=>o("update:show",h),g=()=>{e.closeOnClick&&w(!1)},a=()=>clearTimeout(u),f=()=>{const{icon:h,type:m,iconSize:I,iconPrefix:M,loadingType:$}=e;if(h||m==="success"||m==="fail")return c(Me,{name:h||m,size:I,class:z("icon"),classPrefix:M},null);if(m==="loading")return c(je,{class:z("loading"),size:I,type:$},null)},x=()=>{const{type:h,message:m}=e;if(l.message)return c("div",{class:z("text")},[l.message()]);if(Re(m)&&m!=="")return h==="html"?c("div",{key:0,class:z("text"),innerHTML:String(m)},null):c("div",{class:z("text")},[m])};return _(()=>[e.show,e.forbidClick],y),_(()=>[e.show,e.type,e.message,e.duration],()=>{a(),e.show&&e.duration>0&&(u=setTimeout(()=>{w(!1)},e.duration))}),xe(y),Oe(y),()=>c(we,ue({class:[z([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:g,onClosed:a,"onUpdate:show":w},q(e,Je)),{default:()=>[f(),x()]})}});const Ge={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let Z=[],Xe=!1,ge=de({},Ge);const Ze=new Map;function pe(e){return Be(e)?e:{message:e}}function et(){const{instance:e,unmount:o}=Ve({setup(){const l=W(""),{open:u,state:d,close:y,toggle:w}=Ye(),g=()=>{},a=()=>c(Se,ue(d,{onClosed:g,"onUpdate:show":w}),null);return _(l,f=>{d.message=f}),Ie().render=a,{open:u,close:y,message:l}}});return e}function tt(){if(!Z.length||Xe){const e=et();Z.push(e)}return Z[Z.length-1]}function ye(e={}){if(!Pe)return{};const o=tt(),l=pe(e);return o.open(de({},ge,Ze.get(l.type||ge.type),l)),o}be(Se);const[nt,b,N]=K("calendar"),at=e=>N("monthTitle",e.getFullYear(),e.getMonth()+1);function re(e,o){const l=e.getFullYear(),u=o.getFullYear();if(l===u){const d=e.getMonth(),y=o.getMonth();return d===y?0:d>y?1:-1}return l>u?1:-1}function P(e,o){const l=re(e,o);if(l===0){const u=e.getDate(),d=o.getDate();return u===d?0:u>d?1:-1}return l}const ee=e=>new Date(e),ve=e=>Array.isArray(e)?e.map(ee):ee(e);function fe(e,o){const l=ee(e);return l.setDate(l.getDate()+o),l}const se=e=>fe(e,-1),Te=e=>fe(e,1),ce=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function ot(e){const o=e[0].getTime();return(e[1].getTime()-o)/(1e3*60*60*24)+1}de({},Ue,{modelValue:Ae(),filter:Function,formatter:{type:Function,default:(e,o)=>o}});const lt=(e,o)=>32-new Date(e,o-1,32).getDate(),[it]=K("calendar-day");var rt=J({name:it,props:{item:p(Object),color:String,index:Number,offset:De(0),rowHeight:String},emits:["click","clickDisabledDate"],setup(e,{emit:o,slots:l}){const u=R(()=>{var a;const{item:f,index:x,color:h,offset:m,rowHeight:I}=e,M={height:I};if(f.type==="placeholder")return M.width="100%",M;if(x===0&&(M.marginLeft="".concat(100*m/7,"%")),h)switch(f.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":M.background=h;break;case"middle":M.color=h;break}return m+(((a=f.date)==null?void 0:a.getDate())||1)>28&&(M.marginBottom=0),M}),d=()=>{e.item.type!=="disabled"?o("click",e.item):o("clickDisabledDate",e.item)},y=()=>{const{topInfo:a}=e.item;if(a||l["top-info"])return c("div",{class:b("top-info")},[l["top-info"]?l["top-info"](e.item):a])},w=()=>{const{bottomInfo:a}=e.item;if(a||l["bottom-info"])return c("div",{class:b("bottom-info")},[l["bottom-info"]?l["bottom-info"](e.item):a])},g=()=>{const{item:a,color:f,rowHeight:x}=e,{type:h,text:m}=a,I=[y(),m,w()];return h==="selected"?c("div",{class:b("selected-day"),style:{width:x,height:x,background:f}},[I]):I};return()=>{const{type:a,className:f}=e.item;return a==="placeholder"?c("div",{class:b("day"),style:u.value},null):c("div",{role:"gridcell",style:u.value,class:[b("day",a),f],tabindex:a==="disabled"?void 0:-1,onClick:d},[g()])}}});const[st]=K("calendar-month"),ct={date:p(Date),type:String,color:String,minDate:p(Date),maxDate:p(Date),showMark:Boolean,rowHeight:L,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number};var ut=J({name:st,props:ct,emits:["click","clickDisabledDate"],setup(e,{emit:o,slots:l}){const[u,d]=He(),y=W(),w=W(),g=Fe(w),a=R(()=>at(e.date)),f=R(()=>Ne(e.rowHeight)),x=R(()=>{const i=e.date.getDay();return e.firstDayOfWeek?(i+7-e.firstDayOfWeek)%7:i}),h=R(()=>lt(e.date.getFullYear(),e.date.getMonth()+1)),m=R(()=>u.value||!e.lazyRender),I=()=>a.value,M=i=>{const k=v=>e.currentDate.some(D=>P(D,v)===0);if(k(i)){const v=se(i),D=Te(i),T=k(v),t=k(D);return T&&t?"multiple-middle":T?"end":t?"start":"multiple-selected"}return""},$=i=>{const[k,v]=e.currentDate;if(!k)return"";const D=P(i,k);if(!v)return D===0?"start":"";const T=P(i,v);return e.allowSameDay&&D===0&&T===0?"start-end":D===0?"start":T===0?"end":D>0&&T<0?"middle":""},j=i=>{const{type:k,minDate:v,maxDate:D,currentDate:T}=e;if(P(i,v)<0||P(i,D)>0)return"disabled";if(T===null)return"";if(Array.isArray(T)){if(k==="multiple")return M(i);if(k==="range")return $(i)}else if(k==="single")return P(i,T)===0?"selected":"";return""},U=i=>{if(e.type==="range"){if(i==="start"||i==="end")return N(i);if(i==="start-end")return"".concat(N("start"),"/").concat(N("end"))}},Q=()=>{if(e.showMonthTitle)return c("div",{class:b("month-title")},[l["month-title"]?l["month-title"]({date:e.date,text:a.value}):a.value])},G=()=>{if(e.showMark&&m.value)return c("div",{class:b("month-mark")},[e.date.getMonth()+1])},X=R(()=>{const i=Math.ceil((h.value+x.value)/7);return Array(i).fill({type:"placeholder"})}),V=R(()=>{const i=[],k=e.date.getFullYear(),v=e.date.getMonth();for(let D=1;D<=h.value;D++){const T=new Date(k,v,D),t=j(T);let n={date:T,type:t,text:D,bottomInfo:U(t)};e.formatter&&(n=e.formatter(n)),i.push(n)}return i}),B=R(()=>V.value.filter(i=>i.type==="disabled")),te=(i,k)=>{if(y.value){const v=le(y.value),D=X.value.length,t=(Math.ceil((k.getDate()+x.value)/7)-1)*v.height/D;$e(i,v.top+t+i.scrollTop-le(i).top)}},ne=(i,k)=>c(rt,{item:i,index:k,color:e.color,offset:x.value,rowHeight:f.value,onClick:v=>o("click",v),onClickDisabledDate:v=>o("clickDisabledDate",v)},q(l,["top-info","bottom-info"])),ae=()=>c("div",{ref:y,role:"grid",class:b("days")},[G(),(m.value?V:X).value.map(ne)]);return ke({getTitle:I,getHeight:()=>g.value,setVisible:d,scrollToDate:te,disabledDays:B}),()=>c("div",{class:b("month"),ref:w},[Q(),ae()])}});const[dt]=K("calendar-header");var ft=J({name:dt,props:{date:Date,title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["clickSubtitle"],setup(e,{slots:o,emit:l}){const u=()=>{if(e.showTitle){const g=e.title||N("title"),a=o.title?o.title():g;return c("div",{class:b("header-title")},[a])}},d=g=>l("clickSubtitle",g),y=()=>{if(e.showSubtitle){const g=o.subtitle?o.subtitle({date:e.date,text:e.subtitle}):e.subtitle;return c("div",{class:b("header-subtitle"),onClick:d},[g])}},w=()=>{const{firstDayOfWeek:g}=e,a=N("weekdays"),f=[...a.slice(g,7),...a.slice(0,g)];return c("div",{class:b("weekdays")},[f.map(x=>c("span",{class:b("weekday")},[x]))])};return()=>c("div",{class:b("header")},[u(),y(),w()])}});const mt={show:Boolean,type:E("single"),title:String,color:String,round:F,readonly:Boolean,poppable:F,maxRange:ze(null),position:E("bottom"),teleport:[String,Object],showMark:F,showTitle:F,formatter:Function,rowHeight:L,confirmText:String,rangePrompt:String,lazyRender:F,showConfirm:F,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:F,closeOnPopstate:F,showRangePrompt:F,confirmDisabledText:String,closeOnClickOverlay:F,safeAreaInsetTop:Boolean,safeAreaInsetBottom:F,minDate:{type:Date,validator:ie,default:ce},maxDate:{type:Date,validator:ie,default:()=>{const e=ce();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:L,default:0,validator:e=>e>=0&&e<=6}};var ht=J({name:nt,props:mt,emits:["select","confirm","unselect","monthShow","overRange","update:show","clickSubtitle","clickDisabledDate"],setup(e,{emit:o,slots:l}){const u=(t,n=e.minDate,s=e.maxDate)=>P(t,n)===-1?n:P(t,s)===1?s:t,d=(t=e.defaultDate)=>{const{type:n,minDate:s,maxDate:r,allowSameDay:O}=e;if(t===null)return t;const C=ce();if(n==="range"){Array.isArray(t)||(t=[]);const A=u(t[0]||C,s,O?r:se(r)),S=u(t[1]||C,O?s:Te(s));return[A,S]}return n==="multiple"?Array.isArray(t)?t.map(A=>u(A)):[u(C)]:((!t||Array.isArray(t))&&(t=C),u(t))};let y;const w=W(),g=W({textFn:()=>"",date:void 0}),a=W(d()),[f,x]=qe(),h=R(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),m=R(()=>{const t=[],n=new Date(e.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(re(n,e.maxDate)!==1);return t}),I=R(()=>{if(a.value){if(e.type==="range")return!a.value[0]||!a.value[1];if(e.type==="multiple")return!a.value.length}return!a.value}),M=()=>a.value,$=()=>{const t=_e(w.value),n=t+y,s=m.value.map((S,H)=>f.value[H].getHeight()),r=s.reduce((S,H)=>S+H,0);if(n>r&&t>0)return;let O=0,C;const A=[-1,-1];for(let S=0;S<m.value.length;S++){const H=f.value[S];O<=n&&O+s[S]>=t&&(A[1]=S,C||(C=H,A[0]=S),f.value[S].showed||(f.value[S].showed=!0,o("monthShow",{date:H.date,title:H.getTitle()}))),O+=s[S]}m.value.forEach((S,H)=>{const me=H>=A[0]-1&&H<=A[1]+1;f.value[H].setVisible(me)}),C&&(g.value={textFn:C.getTitle,date:C.date})},j=t=>{oe(()=>{m.value.some((n,s)=>re(n,t)===0?(w.value&&f.value[s].scrollToDate(w.value,t),!0):!1),$()})},U=()=>{if(!(e.poppable&&!e.show))if(a.value){const t=e.type==="single"?a.value:a.value[0];ie(t)&&j(t)}else oe($)},Q=()=>{e.poppable&&!e.show||(oe(()=>{y=Math.floor(le(w).height)}),U())},G=(t=d())=>{a.value=t,U()},X=t=>{const{maxRange:n,rangePrompt:s,showRangePrompt:r}=e;return n&&ot(t)>+n?(r&&ye(s||N("rangePrompt",n)),o("overRange"),!1):!0},V=()=>{var t;return o("confirm",(t=a.value)!=null?t:ve(a.value))},B=(t,n)=>{const s=r=>{a.value=r,o("select",ve(r))};if(n&&e.type==="range"&&!X(t)){s([t[0],fe(t[0],+e.maxRange-1)]);return}s(t),n&&!e.showConfirm&&V()},te=(t,n,s)=>{var r;return(r=t.find(O=>P(n,O.date)===-1&&P(O.date,s)===-1))==null?void 0:r.date},ne=R(()=>f.value.reduce((t,n)=>{var s,r;return t.push(...(r=(s=n.disabledDays)==null?void 0:s.value)!=null?r:[]),t},[])),ae=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:s}=e;if(s==="range"){if(!a.value){B([n]);return}const[r,O]=a.value;if(r&&!O){const C=P(n,r);if(C===1){const A=te(ne.value,r,n);if(A){const S=se(A);P(r,S)===-1?B([r,S]):B([n])}else B([r,n],!0)}else C===-1?B([n]):e.allowSameDay&&B([n,n],!0)}else B([n])}else if(s==="multiple"){if(!a.value){B([n]);return}const r=a.value,O=r.findIndex(C=>P(C,n)===0);if(O!==-1){const[C]=r.splice(O,1);o("unselect",ee(C))}else e.maxRange&&r.length>=+e.maxRange?ye(e.rangePrompt||N("rangePrompt",e.maxRange)):B([...r,n])}else B(n,!0)},i=t=>o("update:show",t),k=(t,n)=>{const s=n!==0||!e.showSubtitle;return c(ut,ue({ref:x(n),date:t,currentDate:a.value,showMonthTitle:s,firstDayOfWeek:h.value},q(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:ae,onClickDisabledDate:r=>o("clickDisabledDate",r)}),q(l,["top-info","bottom-info","month-title"]))},v=()=>{if(l.footer)return l.footer();if(e.showConfirm){const t=l["confirm-text"],n=I.value,s=n?e.confirmDisabledText:e.confirmText;return c(Le,{round:!0,block:!0,type:"primary",color:e.color,class:b("confirm"),disabled:n,nativeType:"button",onClick:V},{default:()=>[t?t({disabled:n}):s||N("confirm")]})}},D=()=>c("div",{class:[b("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[v()]),T=()=>{const t=g.value.textFn();return c("div",{class:b()},[c(ft,{date:g.value.date,title:e.title,subtitle:t,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:h.value,onClickSubtitle:n=>o("clickSubtitle",n)},q(l,["title","subtitle"])),c("div",{ref:w,class:b("body"),onScroll:$},[m.value.map(k)]),D()])};return _(()=>e.show,Q),_(()=>[e.type,e.minDate,e.maxDate],()=>G(d(a.value))),_(()=>e.defaultDate,(t=null)=>{a.value=t,U()}),ke({reset:G,scrollToDate:j,getSelectedDate:M}),We(Q),()=>e.poppable?c(we,{show:e.show,class:b("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":i},{default:T}):T()}});const kt=be(ht);export{kt as C};
