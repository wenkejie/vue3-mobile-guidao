import{_ as he}from"./Container.vue_vue_type_script_setup_true_lang-GLuEUgiL.js";import{d as ye,r as o,c as we,aB as ge,q as ke,ai as be,e as r,f as s,K as Ie,o as i,g as l,v as u,C as k,p,k as G,m as Ce,F as De,aC as te,a1 as $e,a2 as Te}from"./index-CIq-oMdo.js";import{f as Ue,T as Ve}from"./index-CKZ_uliA.js";import"./index-C0-qw_Ps.js";import{C as xe}from"./index-BheCoyUB.js";import{C as Ae}from"./index-H4v7lFx6.js";import"./index-gofcAkLv.js";import{F as Se}from"./index-CfBzFnno.js";import{S as qe,a as Ne}from"./index-C1wYFSlc.js";import{c as Fe,a as Qe,u as Be,s as b,d as Pe,G as Me}from"./index-Da8Krel5.js";import{B as Ee}from"./index-CCszsqzv.js";import{F as Le}from"./index-BLH94utM.js";import{P as ze}from"./index-DEoV0_af.js";import{P as Ge}from"./index-DY168d6S.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-scope-id-sANgzUDS.js";import"./index-s7_3JXei.js";import"./use-id-BlRh9Qoc.js";const oe=I=>($e("data-v-81dd65b5"),I=I(),Te(),I),je={class:"iframe-grid mt-10"},He=["src"],Ke={key:1,class:"mt-20 text-right"},Oe={key:0},Ye=oe(()=>p("h3",{class:"text-center"},"下发设置",-1)),Je={class:"m-15"},We=oe(()=>p("h3",{class:"text-center"},"请根据文件内容答题",-1)),Xe={class:"m-15"},Ze=ye({__name:"detail",setup(I){const q=o(0),d=o([]),R=o([]);o({src:"https://m.baidu.com/"});const C=Ie(),D=o({}),$=o(!1),N=o(!1),j=o(!1),F=o(!1),H=o(""),f=o(!1),Q=o(null),_=o({circulationDocId:"",userAnswers:[]}),h=o(1),B=o(!1),P=o({circulationDocId:"",studyDuration:0}),y=o(0),K=o([]),O=o([]),Y=o([]),M=o(0),E=o([]),L=o(0),c=o(0),w=o(null);we(()=>Math.round(c.value));function J(t){g(2),Be(_.value).then(e=>{e.statusCode===200?(b({type:"success",message:"提交成功"}),g(2),te.go(-1)):(b({type:"danger",message:e.msg}),h.value=1)})}const W=t=>"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate());function ne(t){const[e,a]=t;$.value=!1,D.value.dateTime="".concat(W(e)," ~ ").concat(W(a))}async function ae(t){return Me({DepartmentId:t,Skip:1,PageSize:50}).then(e=>e.map(a=>({text:a.firstName,id:Number(a.userName)})))}async function se(t){q.value=t;const e=R.value[t];if(!e.children){const a=await ae(e.id);e.children=a}}function le(t){const e=[...d.value],a=e.indexOf(t.id);a===-1?e.push(t.id):e.splice(a,1),d.value=e,D.value.persons=e}function ie(){const t=C.query.documentId,e=C.query.name;Qe(t).then(a=>{const z=a.result,x="".concat("http://172.20.153.9:5001/","api/document/").concat(t,"/officeviewer?token=").concat(z,"&isVersion=false&fullfilename=").concat(e),A=new TextEncoder().encode(x),v=Ue(A);H.value="http://172.20.153.9:8012/onlinePreview?url=".concat(v)})}function T(){w.value===null&&(L.value=Date.now(),w.value=window.setInterval(X,1e3))}function U(){w.value!==null&&(clearInterval(w.value),w.value=null,X())}function X(){const t=Date.now();c.value+=Math.floor((t-L.value)/1e3),L.value=t,console.log(c.value,"readingTime")}function Z(){document.visibilityState==="hidden"?U():document.visibilityState==="visible"&&T()}function ue({selectedOptions:t}){var e;E.value[M.value]=t.map(a=>a.description).join("/"),_.value.userAnswers[M.value].answerId=(e=t[0])==null?void 0:e.id,f.value=!1}function re(t,e){Y.value=O.value.find(a=>a.questionId===t).options,M.value=e,f.value=!0}function g(t){P.value.studyDuration=Math.round(c.value),Pe(P.value).then(e=>{e.statusCode===200?h.value=t:(b({type:"danger",message:e.msg}),h.value=0)})}function de(){U(),c.value>y.value?(g(2),te.back(-1)):(b({type:"warning",message:"学习时间不足".concat(y.value,"秒")}),T())}function ce(){U(),c.value>y.value?(g(2),F.value=!0):(b({type:"warning",message:"学习时间不足".concat(y.value,"秒")}),T())}ge(()=>{Q.value=C.query.isFinished}),ke(()=>{T(),ie(),Fe({id:C.query.id}).then(t=>{_.value.circulationDocId=t.data.id,P.value.circulationDocId=t.data.id,B.value=t.data.isHasQuestion,y.value=Number(t.data.browseDuration),t.data.circulationQuestions.forEach(e=>{O.value.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,options:e.circulationQuestionAnswers}),_.value.userAnswers.push({questionId:e.circulationQuestionAnswers[0].circulationQuestionId,answerId:""}),K.value.push(e.title)})}),document.addEventListener("visibilitychange",Z)}),be(()=>{U(),document.removeEventListener("visibilitychange",Z)});const me={text:"description",value:"id"};return(t,e)=>{const a=qe,z=Ne,m=Ee,V=Se,x=Ae,A=Le,v=ze,ve=Ge,pe=xe,fe=Ve,_e=he;return i(),r(_e,null,{default:s(()=>[Q.value=="false"?(i(),r(z,{key:0,active:t.active,class:"mt10"},{default:s(()=>[l(a,null,{default:s(()=>[u("查看")]),_:1}),B.value?(i(),r(a,{key:0},{default:s(()=>[u("答题")]),_:1})):k("",!0),l(a,null,{default:s(()=>[u("确认")]),_:1})]),_:1},8,["active"])):k("",!0),p("div",je,[p("iframe",{ref:"iframe",src:H.value,width:"100%",height:"500px",frameborder:"0",allowfullscreen:""},null,8,He)]),Q.value=="false"?(i(),G("div",Ke,[B.value?(i(),G("div",Oe,[h.value===1?(i(),r(m,{key:0,type:"primary",size:"small",block:"",onClick:ce},{default:s(()=>[u("答题")]),_:1})):k("",!0),h.value===2?(i(),r(m,{key:1,type:"primary",size:"small",block:"",onClick:e[0]||(e[0]=n=>g(2))},{default:s(()=>[u("确认")]),_:1})):k("",!0)])):(i(),r(m,{key:1,type:"primary",size:"small",block:"",onClick:e[1]||(e[1]=n=>de(2))},{default:s(()=>[u("确认")]),_:1}))])):k("",!0),l(v,{show:j.value,"onUpdate:show":e[6]||(e[6]=n=>j.value=n),position:"bottom",title:"下发设置",style:{width:"100%",height:"80%"}},{default:s(()=>[Ye,l(A,{onSubmit:J},{default:s(()=>[l(x,{inset:""},{default:s(()=>[l(V,{modelValue:D.value.dateTime,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value.dateTime=n),"is-link":"",readonly:"",name:"datePicker",label:"时间选择",placeholder:"点击选择时间",onClick:e[3]||(e[3]=n=>$.value=!0)},null,8,["modelValue"]),l(V,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value=n),"is-link":"",readonly:"",name:"persons",label:"人员选择",placeholder:"点击下发人员",onClick:e[5]||(e[5]=n=>N.value=!0)},null,8,["modelValue"])]),_:1}),p("div",Je,[l(m,{round:"",block:"",type:"primary","native-type":"submit"},{default:s(()=>[u("提交")]),_:1})])]),_:1})]),_:1},8,["show"]),l(v,{show:F.value,"onUpdate:show":e[7]||(e[7]=n=>F.value=n),position:"bottom",title:"答题",style:{width:"100%",height:"80%"}},{default:s(()=>[We,l(A,{onSubmit:J},{default:s(()=>[l(x,{inset:""},{default:s(()=>[(i(!0),G(De,null,Ce(_.value.userAnswers,(n,S)=>(i(),r(V,{placeholder:"请选择答案",key:n.questionId,modelValue:E.value[S],"onUpdate:modelValue":ee=>E.value[S]=ee,disabled:"",label:"".concat(K.value[S],":"),"label-width":"160px","label-align":"right",onClick:ee=>re(n.questionId,S)},null,8,["modelValue","onUpdate:modelValue","label","onClick"]))),128))]),_:1}),p("div",Xe,[l(m,{round:"",block:"",type:"primary","native-type":"submit"},{default:s(()=>[u("提交")]),_:1})])]),_:1})]),_:1},8,["show"]),l(v,{show:f.value,"onUpdate:show":e[9]||(e[9]=n=>f.value=n),position:"bottom"},{default:s(()=>[l(ve,{columns:Y.value,"columns-field-names":me,onConfirm:ue,onCancel:e[8]||(e[8]=()=>f.value=!1)},null,8,["columns"])]),_:1},8,["show"]),l(pe,{show:$.value,"onUpdate:show":e[10]||(e[10]=n=>$.value=n),type:"range",onConfirm:ne},null,8,["show"]),l(v,{show:N.value,"onUpdate:show":e[13]||(e[13]=n=>N.value=n),position:"bottom"},{default:s(()=>[l(fe,{"active-id":d.value,"onUpdate:activeId":e[11]||(e[11]=n=>d.value=n),"main-active-index":q.value,"onUpdate:mainActiveIndex":e[12]||(e[12]=n=>q.value=n),items:R.value,onClickNav:se,onClickItem:le},null,8,["active-id","main-active-index","items"])]),_:1},8,["show"])]),_:1})}}}),yt=Re(Ze,[["__scopeId","data-v-81dd65b5"]]);export{yt as default};
